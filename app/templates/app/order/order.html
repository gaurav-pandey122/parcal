{% extends 'app/base.html' %}
{% load static %}
{% block content %}
    <div class="page-content">
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0">{{ state.1 }} Deliveries</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Deliveries</a></li>
                                <li class="breadcrumb-item active">List</li>
                            </ol>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end page title -->

            {% if state.0 == 'active' %}
                <div class="row">
                    {% for sts in status %}
                        <div class="col-xl-2 col-md-6">
                            <!-- card -->
                            <div class="card card-animate">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <p class="text-uppercase fw-medium text-muted mb-0">
                                                {{ sts.1 }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div>
                                            <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                                <span class="counter-value" data-target="1">1</span>
                                            </h4>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="counter-value" data-target="1">1</span>%
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    {% endfor %}
                    <div class="col-xl-2 col-md-6">
                        <!-- card -->
                        <div class="card card-animate">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <p class="text-uppercase fw-medium text-muted mb-0">Collectable amount</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-end justify-content-between mt-4">
                                    <div>
                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                            <span class="counter-value" data-target="409.66">0</span>k
                                        </h4>
                                    </div>
                                    <div class="avatar-sm flex-shrink-0">
                                            <span class="avatar-title bg-light rounded fs-3">
                                              <i data-feather="file-text" class="text-primary icon-dual-primary"></i>
                                            </span>
                                    </div>
                                </div>
                            </div><!-- end card body -->
                        </div><!-- end card -->
                    </div><!-- end col -->
                </div> <!-- end row-->
            {% elif state.0 == 'delivered' %}
                <div class="row">
                    <div class="col-xl-2 col-md-6">
                        <!-- card -->
                        <div class="card card-animate">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <p class="text-uppercase fw-medium text-muted mb-0">Total</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-end justify-content-between mt-4">
                                    <div>
                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                            <span class="counter-value" data-target="409.66">0</span>k
                                        </h4>
                                    </div>

                                </div>
                            </div><!-- end card body -->
                        </div><!-- end card -->
                    </div><!-- end col -->
                    {% for sts in status %}
                        <div class="col-xl-2 col-md-6">
                            <!-- card -->
                            <div class="card card-animate">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <p class="text-uppercase fw-medium text-muted mb-0">
                                                {{ sts.1 }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div>
                                            <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                                <span class="counter-value" data-target="1">1</span>
                                            </h4>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="counter-value" data-target="1">1</span>%
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    {% endfor %}
                    <div class="col-xl-2 col-md-6">
                        <!-- card -->
                        <div class="card card-animate">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <p class="text-uppercase fw-medium text-muted mb-0">Collectable amount</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-end justify-content-between mt-4">
                                    <div>
                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                            <span class="counter-value" data-target="409.66">0</span>k
                                        </h4>
                                    </div>
                                    <div class="avatar-sm flex-shrink-0">
                                            <span class="avatar-title bg-light rounded fs-3">
                                              <i data-feather="file-text" class="text-primary icon-dual-primary"></i>
                                            </span>
                                    </div>
                                </div>
                            </div><!-- end card body -->
                        </div><!-- end card -->
                    </div><!-- end col -->
                </div> <!-- end row-->
            {% elif state.0 == 'returned' %}
                <div class="row">
                    <div class="col-xl-2 col-md-6">
                        <!-- card -->
                        <div class="card card-animate">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <p class="text-uppercase fw-medium text-muted mb-0">Total</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-end justify-content-between mt-4">
                                    <div>
                                        <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                            <span class="counter-value" data-target="409.66">0</span>k
                                        </h4>
                                    </div>
                                    <div class="avatar-sm flex-shrink-0">
                                            <span class="avatar-title bg-light rounded fs-3">
                                              <i data-feather="file-text" class="text-primary icon-dual-primary"></i>
                                            </span>
                                    </div>
                                </div>
                            </div><!-- end card body -->
                        </div><!-- end card -->
                    </div><!-- end col -->
                    {% for sts in status %}
                        <div class="col-xl-2 col-md-6">
                            <!-- card -->
                            <div class="card card-animate">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <p class="text-uppercase fw-medium text-muted mb-0">
                                                {{ sts.1 }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div>
                                            <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                                <span class="counter-value" data-target="1">1</span>
                                            </h4>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="counter-value" data-target="1">1</span>%
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    {% endfor %}

                </div> <!-- end row-->
            {% elif state.0 == 'reverse_delivery' %}
                <div class="row">
                    {% for sts in status %}
                        <div class="col-xl-2 col-md-6">
                            <!-- card -->
                            <div class="card card-animate">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <p class="text-uppercase fw-medium text-muted mb-0">
                                                {{ sts.1 }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="">
                                        <div>
                                            <h4 class="fs-22 fw-semibold ff-secondary mb-4">
                                                <span class="counter-value" data-target="1">1</span>
                                            </h4>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="counter-value" data-target="1">1</span>%
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    {% endfor %}
                </div> <!-- end row-->
            {% endif %}

            <div class="row">
                <div class="col-lg-12">
                    <div class="card" id="orderList">
                        <div class="card-body border border-dashed border-end-0 border-start-0">
                            <form>
                                <div class="row g-3">
                                    <div class="col-xxl-5 col-sm-6">
                                        <div class="search-box">
                                            <input type="text" class="form-control search" name="q"
                                                   placeholder="Search for Consignment ID, order ID, customer, ...">
                                            <i class="ri-search-line search-icon"></i>
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-2 col-sm-6">
                                        <div>
                                            <input type="text" class="form-control" data-provider="flatpickr"
                                                   data-date-format="d M, Y" data-range-date="true"
                                                   id="datepicker-range"
                                                   placeholder="Select date range" name="date">
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-2 col-sm-4">
                                        <div>
                                            <select class="form-control" data-choices data-choices-search-false
                                                    name="choices-single-default" id="idStatus">
                                                <option value="" selected disabled>Status</option>
                                                <option value="all">All</option>
                                                {% for sts in status %}
                                                    <option value="{{ sts.0 }}">{{ sts.1 }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <!--end col-->

                                    <!--end col-->
                                    <div class="col-xxl-1 col-sm-4 d-flex">
                                        <button type="button" class="btn btn-primary w-100" onclick="SearchData();">
                                            Filters
                                        </button>
                                        <a href="{% url 'delivery-create' %}" class="btn btn-success w-100 ms-1">
                                            New
                                        </a>
                                    </div>
                                    <!--end col-->
                                </div>
                                <!--end row-->
                            </form>
                        </div>
                        <div class="card-body pt-0">
                            <div>
                                <div class="table-responsive table-card mb-1">
                                    <table class="table table-nowrap align-middle" id="orderTable">
                                        <thead class="text-muted table-light">
                                        <tr class="text-uppercase fs-13">
                                            <th>S.N</th>
                                            <th data-ordering="true">Consignment ID</th>
                                            <th data-ordering="false">Order ID</th>
                                            <th>Store</th>
                                            <th data-ordering="false">Customer</th>
                                            <th>Delivery Status</th>
                                            <th>Amount</th>
                                            <th>Payment</th>
                                            <th data-ordering="false">Action</th>
                                        </tr>
                                        </thead>
                                        <tbody class="">

                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!--end col-->
            </div>

        </div><!-- container-fluid -->
    </div>
{% endblock %}
{% block script %}
    <script>
        $(function () {
            new DataTable("#orderTable", {
                fixedHeader: true,
                searching: false,
                lengthMenu: [10, 25, 50, 100],
                pageLength: 25,
                destroy: true,
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{% url 'delivery-api' %}",
                    type: "POST",
                    data: {
                        "state": "all",
                        "status": 'pending',
                        "q": "1"
                    }
                },
                order: [
                    [5, "DESC"]
                ],
                columns: [
                    {data: 'id'},
                    {data: 'consignment_id'},
                    {data: 'order_id'},
                    {data: 'store'},
                    {data: 'customer_name'},
                    {data: 'status'},
                    {data: 'amount'},
                    {data: 'order_date'},
                    {data: 'item_description'},
                ],
                columnDefs: [
                    {"orderable": false, "targets": [2]},
                    {"orderable": false, "targets": [3]},
                    {"orderable": false, "targets": [6]},
                    {"orderable": false, "targets": [8]},
                ],
            });
        })
    </script>
{% endblock %}
